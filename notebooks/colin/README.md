# Colin Worklog

# 2022-02-07 - Meeting for Project Proposal
We met to discuss the inner workings of the project proposal.  Specific attention was paid to the parts (i.e. sensors) and the block diagram, which Richard and I developed.  Progress is still needed for both of these components before finalizing the proposal by Thursday, 02/10.

# 2022-02-08 - First Meeting with Qingyu
Today we met with Qingyu for the first time to discuss where our project is at right now.  We will shift our focus to a few key details as we finish the project proposal:
1. Planning how we will demonstrate the various functions of the traffic light
2. Adding details to block diagram (i.e. sensor protocols and specific parts)
3. Contacting TA Evan Widloski and Professors Schuh and Banerjee about the power switching component of our design
    * LTC4412 - OR'ing of multiple power sources ([datasheet](https://www.analog.com/media/en/technical-documentation/data-sheets/4412fb.pdf "LTC4412"))
    * Power MUX
    * Possibility of manual switch (worst case scenario)

I will email the people listed above for advice about which strategy to use, while in the search of new ideas.

# 2022-02-10 - Finishing the Proposal
Today we were able to put the finishing touches on the project proposal by clarifying the high-level and subsystem requirements.  I also placed a sample order for the LTC4357 and LTC4359 chips from Analog Devices.  The chips will be delivered soon and a pair of one device (likely LTC4359) will be used to manage the switching between the solar and grid power.  They will control which source is used by driving an external pair of complementary MOSFETs.  These MOSFETs still need to be chosen.  Refer to the following datasheets: [LTC4357](https://www.analog.com/media/en/technical-documentation/data-sheets/4357fd.pdf "LTC4357") and [LTC4359](https://www.analog.com/media/en/technical-documentation/data-sheets/ltc4359.pdf "LTC4359")

# 2022-02-14 - Selecting More Components
We met today to discuss some of the finer details of the project that had not been ironed out yet.  We have now decided on the LTC4359 to aid in the switching of the two power sources, but are also exploring options about how to monitor the available solar power when it has already been switched off.  Our most likely option is a "dummy" load consisting of a simple power resistor but we will discuss this with out TA tomorrow.

# 2022-02-15 - Weekly TA Meeting
After discussing with Qingyu during our weekly meeting, we have decided to follow through with the dead load resistor to allow the power monitor to determine the power generated by the solar panel.  When it is above a threshold of approximately 20 W, set by choosing a resistor such that PR = V<sup>2</sup> for P = 20 W and V = 24 V.  This resistance value may be decreased further based on power consumption approximations.  A rough sketch can be seen in the following schematic, which will be expanded upon in later meetings and the PCB design.

![Dead Load Resistor](https://github.com/bobo-nums/ece445/blob/main/notebooks/colin/power_sketch.JPG)

# 2022-02-22 - Designing SEPIC Converter
We had intended on utilizing some sort of buck-boost converter to regulate the solar output voltage to 24 V Â± 5% but had not yet chosen a DC-DC comversion topology.  In order to minimize the ripple at the output and provide a stable voltage to the rest of the system, we chose a single-ended primary-inductor converter (SEPIC).  A rough sketch of this can be seen below:

![SEPIC Sketch](https://github.com/bobo-nums/ece445/blob/main/notebooks/colin/sepic_sketch.JPG)

Calculations to ensure the SEPIC can withstand minimum and maximum duty cycles and to determine component selection and ratings can also be seen below:

![SEPIC Calculations](https://github.com/bobo-nums/ece445/blob/main/notebooks/colin/sepic_calculations.JPG)

# 2022-02-23 - Back to the Drawing Board for the Switching Network
Today I worked on the switching network of our power subsystem, which will be responsible for automatically switching between the two power sources.  Our initial idea and design involved an ORing controller ([LTC4359](https://www.analog.com/media/en/technical-documentation/data-sheets/ltc4359.pdf "LTC4359")).  This circuit can be seen below:

![Original Switching Network](https://github.com/bobo-nums/ece445/blob/main/notebooks/colin/old_switching.png)

However, we decided to move away from this design due to the substantial voltage drop while switching between the sources.  The simulation waveform (with compensation capacitors at the output) can be seen below with a significant voltage dip:

![Original Switching Waveform](https://github.com/bobo-nums/ece445/blob/main/notebooks/colin/old_switching_waveform.png)

# 2022-02-23 - New Switching Network Design
I realized that in order to switch between the sources while protecting against reverse current between them, it would be possible to simply use two MOSFETs in opposite orientations for each source.  This can be done by controlling a quad high-side gate driver [LT1161](https://www.analog.com/media/en/technical-documentation/data-sheets/1161fa.pdf "LT1161") via the microcontroller.  In LTspice, one can emulate this behavior by sending complementary signals into the inputs of the gate driver.  The schematic and waveform can be seen below:

![New Switching Network](https://github.com/bobo-nums/ece445/blob/main/notebooks/colin/switching.png)

![New Switching Waveform](https://github.com/bobo-nums/ece445/blob/main/notebooks/colin/switching_sim.png)

As we can see, the voltage dip is negligible compared to that of the original design using the LTC4359 chip.  I can confidently say this is a simple method to switch between the sources while providing the desired functionality and protection.  One must note that the gate driver must possess high-side functionality due to the MOSFETs being along the 24 V node.

# 2022-02-24 - Finishing Design Document
Today we finished up the design document, taking into account feedback from our Design Document Check with Professor Shao.  We have added additional details into our high-level requirements based on this feedback.  Additionally, we realized that we must select a proper heat sink for the power resistor at the solar output.  Without it, our chosen resistor is only rated for 3 W.

# 2022-03-01 - Discussing Voltage Isolation
Today we discussed whether to implement isolation between the 24 V voltage levels and the 3.3 V and 5 V levels required for the MCU and sensors.  This would require additional components beyond what we already ordered for our power board but we decided this was worth the extra effort to ensure signal integrity for our sensors.  Thus, we will be altering our existing power board to include small (2-5 W) isolated DC-DC converters.  Based on our calculations of the power consumption of our MCU and sensors, we will draw a maximum of 0.5 W from our converters.

# 2022-03-02 - Voltage Isolation Designing
Upon further analysis, we have decided to move the step-down voltage conversion to the MCU board to be closer to the sensors and MCU.  Thus, we will also require jumpers between the boards to provide 5 V and isolated ground to the power board for a few components.  We have decided to utilize the SPBW03F-05 isolated DC-DC converter [SPBW03F-05](https://www.meanwellusa.com/productPdf.aspx?i=794 "SPBW03F-05") for our 5 V level.  This provides isolation and is rated for up to 3 W, which provides the maximum required power drawn by the sensors and allows leeway for additional power drawn during the operation of the MCU.

Additionally, in order to allow for proper voltage isolation, we will include opto-isolators [MOCD207M](https://www.mouser.com/datasheet/2/308/1/MOCD217M_D-2316206.pdf "MOCD207M") that can transmit the signals from our sensors across the different ground levels.

# 2022-03-04 - MCU Board Design in KiCAD
Today I began the design of the MCU board in KiCAD, which will include selecting parts and their corresponding footprints, developing the schematic, and routing traces and any additional debugging on the PCB side of KiCAD.  I plan on designing the board in this order and hope to finish it within the next few days.

# 2022-03-07 - Finished MCU Board
The MCU board is now complete and has passed PCBway audit.  I have now submitted a parts order online and sent the functional Gerber files to Qingyu.  The schematic and board itself are located below:

![MCU Board Schematic](https://github.com/bobo-nums/ece445/blob/main/notebooks/colin/mcu_schematic.png)

![MCU Board](https://github.com/bobo-nums/ece445/blob/main/notebooks/colin/mcu_board.png)

![3D View of MCU Board](https://github.com/bobo-nums/ece445/blob/main/notebooks/colin/mcu_board3d.png)

# 2022-03-10 - Testing Bike/Pedestrian light
Richard placed a sample for the bike and traffic lights from Leotek and he and Bowen tested the DC traffic light modules for their various operating points and turn-on points previously.  However, the bike light we received ([Datasheet](https://leotek.com/wp-content/uploads/il6-bicycle-signal-spec_sheet.pdf "Bike Light")) is AC-powered and needed to be tested in the power lab to determine its operating points. I was able to access the Power Lab today to utilize the Variac and Yokogawa power meters for this purpose.  Combined with the previous operating points determined by Bowen and Richard, the following values represent the operating point of each of our 
